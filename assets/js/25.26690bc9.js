(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{570:function(t,e,a){"use strict";a.r(e);var s=a(2),r=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"防火墙"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防火墙"}},[t._v("#")]),t._v(" 防火墙")]),t._v(" "),a("ul",[a("li",[t._v("Linux使用的防火墙系统包括两部分: netfilter和iptables，netfilter/iptables框架可以实现数据包过滤、地址转换和数据包管理功能。")]),t._v(" "),a("li",[t._v("默认的iptables规则表有："),a("strong",[t._v("fileter表(过滤规则表)、nat表(地址转换规则表)、mangle(修改数据标记位规则表)、raw(跟踪数据表规则表)")]),t._v("。每个规则表中都有多个数据链："),a("strong",[t._v("INPUT(入站数据过滤)、OUTPUT(出站数据过滤)、FORWARD(转发数据过滤)、PREROUTING(路由前过滤)、POSTROUTING(路由后过滤)")]),t._v("。\n"),a("img",{attrs:{src:"/img/200603/iptables.jpg",alt:"Linux防火墙过滤框架"}})]),t._v(" "),a("li",[t._v("图中防火墙会对数据包进行判断决策：如果是外部主机发送数据包给防火墙主机，则会经过PREROUTING和INPUT链；如果是本机发送数据包给外部主机，则经过OUTPUT和POSTROUTING链；如果防火墙为路由，则负责转发数据，经过PREROUTING、FORWARD和POSTOUTING链。")])]),t._v(" "),a("h1",{attrs:{id:"iptables"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#iptables"}},[t._v("#")]),t._v(" iptables")]),t._v(" "),a("h2",{attrs:{id:"iptables语法格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#iptables语法格式"}},[t._v("#")]),t._v(" iptables语法格式")]),t._v(" "),a("ul",[a("li",[t._v("用法格式：iptables [-t 表名] {-A|-D|-I|-F|-L|-Z|-P} 链名 rule-specification")]),t._v(" "),a("li",[t._v("选项")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("选项")]),t._v(" "),a("th",[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("-t")]),t._v(" "),a("td",[t._v("指定需要维护的防火墙规则表")])]),t._v(" "),a("tr",[a("td",[t._v("-A")]),t._v(" "),a("td",[t._v("追加防火墙规则")])]),t._v(" "),a("tr",[a("td",[t._v("-D")]),t._v(" "),a("td",[t._v("删除防火墙规则")])]),t._v(" "),a("tr",[a("td",[t._v("-I")]),t._v(" "),a("td",[t._v("插入防火墙规则")])]),t._v(" "),a("tr",[a("td",[t._v("-F")]),t._v(" "),a("td",[t._v("清空防火墙规则")])]),t._v(" "),a("tr",[a("td",[t._v("-L")]),t._v(" "),a("td",[t._v("列出防火墙规则")])]),t._v(" "),a("tr",[a("td",[t._v("-R")]),t._v(" "),a("td",[t._v("替换防火墙规则")])]),t._v(" "),a("tr",[a("td",[t._v("-Z")]),t._v(" "),a("td",[t._v("清空防火墙数据表统计信息")])]),t._v(" "),a("tr",[a("td",[t._v("-P")]),t._v(" "),a("td",[t._v("设置链默认规则")])])])]),t._v(" "),a("ul",[a("li",[t._v("匹配参数(均可使用!取反)")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数")]),t._v(" "),a("th",[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("-p")]),t._v(" "),a("td",[t._v("匹配协议")])]),t._v(" "),a("tr",[a("td",[t._v("-s")]),t._v(" "),a("td",[t._v("匹配源地址")])]),t._v(" "),a("tr",[a("td",[t._v("-d")]),t._v(" "),a("td",[t._v("匹配目标地址")])]),t._v(" "),a("tr",[a("td",[t._v("-i")]),t._v(" "),a("td",[t._v("匹配入站网卡接口")])]),t._v(" "),a("tr",[a("td",[t._v("-o")]),t._v(" "),a("td",[t._v("匹配出站网卡接口")])]),t._v(" "),a("tr",[a("td",[t._v("--sport")]),t._v(" "),a("td",[t._v("匹配源端口")])]),t._v(" "),a("tr",[a("td",[t._v("--dport")]),t._v(" "),a("td",[t._v("匹配目标端口")])]),t._v(" "),a("tr",[a("td",[t._v("--src-range")]),t._v(" "),a("td",[t._v("匹配源地址范围")])]),t._v(" "),a("tr",[a("td",[t._v("--dst-range")]),t._v(" "),a("td",[t._v("匹配目标地址范围")])]),t._v(" "),a("tr",[a("td",[t._v("--limit")]),t._v(" "),a("td",[t._v("匹配数据表速率")])]),t._v(" "),a("tr",[a("td",[t._v("--mac-source")]),t._v(" "),a("td",[t._v("匹配源MAC地址")])]),t._v(" "),a("tr",[a("td",[t._v("--sports")]),t._v(" "),a("td",[t._v("匹配源端口")])]),t._v(" "),a("tr",[a("td",[t._v("--dports")]),t._v(" "),a("td",[t._v("匹配目标端口")])]),t._v(" "),a("tr",[a("td",[t._v("--state")]),t._v(" "),a("td",[t._v("匹配状态")])]),t._v(" "),a("tr",[a("td",[t._v("--string")]),t._v(" "),a("td",[t._v("匹配应用层字串")])])])]),t._v(" "),a("ul",[a("li",[t._v("触发动作")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("动作")]),t._v(" "),a("th",[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("ACCEPT")]),t._v(" "),a("td",[t._v("允许数据包通过")])]),t._v(" "),a("tr",[a("td",[t._v("DROP")]),t._v(" "),a("td",[t._v("丢弃数据包")])]),t._v(" "),a("tr",[a("td",[t._v("REJECT")]),t._v(" "),a("td",[t._v("拒绝数据包通过")])]),t._v(" "),a("tr",[a("td",[t._v("LOG")]),t._v(" "),a("td",[t._v("将数据包记录syslog日志")])]),t._v(" "),a("tr",[a("td",[t._v("DNAT")]),t._v(" "),a("td",[t._v("目标地址转换")])]),t._v(" "),a("tr",[a("td",[t._v("ANAT")]),t._v(" "),a("td",[t._v("源地址转换")])]),t._v(" "),a("tr",[a("td",[t._v("MASQUERADE")]),t._v(" "),a("td",[t._v("地址欺骗")])]),t._v(" "),a("tr",[a("td",[t._v("REDIRECT")]),t._v(" "),a("td",[t._v("重定向")])])])]),t._v(" "),a("ul",[a("li",[t._v("命令使用方法")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 查看filter表中所有规则\n[root@Hyui-VM ~]# iptables -nL\n# 查看nat表中所有规则\n[root@Hyui-VM ~]# iptables -t nat -nL\n# 清空filter表中所有规则\n[root@Hyui-VM ~]# iptables -F\n# 在filter表中添加一条入站规则，丢弃223.5.5.5主机发送给防火墙本机的所有数据包\n[root@Hyui-VM ~]# iptables -A INPUT -s 223.5.5.5 -j DROP\n# 在filter表中添加一条入站规则，拒绝223.5.5.5对主机的ping行为\n[root@Hyui-VM ~]# iptables -I INPUT -s 223.5.5.5 -p icmp -j REJECT\n# 查看所有规则并显示编号\n[root@Hyui-VM ~]# iptables -nL --line-number\n# 删除表中的INPUT链第一个规则\n[root@Hyui-VM ~]# iptables -D INPUT 1\n# 替换表中第二条规则，拒绝192.168.31.254之外的任何主机连接本机\n[root@Hyui-VM ~]# iptables -R INPUT 2 ! -s 192.168.31.254 -j REJECT\n# 修改filter表中INPUT链的默认规则为接收数据包\n[root@Hyui-VM ~]# iptables -t filter -P INPUT ACCEPT\n# 放行SSH和DNS要用到的端口\n[root@Hyui-VM ~]# iptables -A INPUT -p tcp --dport 22 -j ACCEPT\n[root@Hyui-VM ~]# iptables -A INPUT -p udp --dport 53 -j ACCEPT\n")])])]),a("h2",{attrs:{id:"iptables防火墙的备份和还原"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#iptables防火墙的备份和还原"}},[t._v("#")]),t._v(" iptables防火墙的备份和还原")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 将备份信息重定向至/etc/sysconfig/iptables\n[root@Hyui-VM ~]# iptables-save > /etc/sysconfig/iptables\n# 将备份信息重定向至./firewall.bak\n[root@Hyui-VM ~]# iptables-save > firewall.bak\n# 还原备份信息\n[root@Hyui-VM ~]# iptables-restore < firewall.bak\n")])])]),a("h1",{attrs:{id:"firewalld"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#firewalld"}},[t._v("#")]),t._v(" firewalld")]),t._v(" "),a("h2",{attrs:{id:"firewall-cmd命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#firewall-cmd命令"}},[t._v("#")]),t._v(" firewall-cmd命令")]),t._v(" "),a("ul",[a("li",[t._v("firewall-cmd通过zones管理防火墙规则，一般public为默认zone")]),t._v(" "),a("li",[t._v("用法：firewall-cmd [OPTIONS...]")])]),t._v(" "),a("h2",{attrs:{id:"firewall-cmd使用示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#firewall-cmd使用示例"}},[t._v("#")]),t._v(" firewall-cmd使用示例")]),t._v(" "),a("ul",[a("li",[t._v("显示所有zone及对应规则信息")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[root@Hyui-VM ~]# firewall-cmd --list-all-zone\n")])])]),a("ul",[a("li",[t._v("在public的zone中添加允许访问ftp的规则")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[root@Hyui-VM ~]# firewall-cmd --add-service=ftp --zone=public\nsuccess\n")])])]),a("ul",[a("li",[t._v("在public的zone中移除允许访问ftp的规则")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[root@Hyui-VM ~]# firewall-cmd --remove-service=ftp --zone=public\nsuccess\n")])])]),a("ul",[a("li",[a("strong",[t._v("在public的zone中添加允许访问8080tcp端口的规则")])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[root@Hyui-VM ~]# firewall-cmd --add-port=8080/tcp --zone=public\nsuccess\n")])])]),a("ul",[a("li",[a("strong",[t._v("在public的zone中移除允许访问8080tcp端口的规则")])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[root@Hyui-VM ~]# firewall-cmd --remove-port=8080/tcp --zone=public\nsuccess\n")])])]),a("ul",[a("li",[t._v("将eth0网卡与public绑定，从该接口进入的流量全部与public匹配")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[root@Hyui-VM ~]# firewall-cmd --add-interface=eth0 --zone=public\nsuccess\n")])])]),a("ul",[a("li",[t._v("将eth0网卡与public解除绑定")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[root@Hyui-VM ~]# firewall-cmd --remove-interface=eth0 --zone=trusted\n")])])]),a("ul",[a("li",[t._v("查看默认zone规则列表和public规则列表")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[root@Hyui-VM ~]# firewall-cmd --list-all\npublic\n  target: default\n  icmp-block-inversion: no\n  interfaces: \n  sources: \n  services: dhcpv6-client ssh\n  ports: 10000/udp 10000/tcp\n  protocols: \n  masquerade: no\n  forward-ports: \n  source-ports: \n  icmp-blocks: \n  rich rules: \n\t\n[root@Hyui-VM ~]# firewall-cmd --list-all --zone=public\npublic\n  target: default\n  icmp-block-inversion: no\n  interfaces: \n  sources: \n  services: dhcpv6-client ssh\n  ports: 10000/udp 10000/tcp\n  protocols: \n  masquerade: no\n  forward-ports: \n  source-ports: \n  icmp-blocks: \n  rich rules:\n")])])]),a("ul",[a("li",[a("strong",[t._v("在public的zone中添加一条永久规则(永久允许访问8080端口)，该规则在重启后依然有效")])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[root@Hyui-VM ~]# firewall-cmd --add-port=8080/tcp --zone=public --permanent\nsuccess\n")])])]),a("ul",[a("li",[a("strong",[t._v("重载防火墙")])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[root@Hyui-VM ~]# firewall-cmd --reload\nsuccess\n")])])])])}),[],!1,null,null,null);e.default=r.exports}}]);